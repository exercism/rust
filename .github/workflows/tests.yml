name: CI

# Run this workflow every time a new commit is pushed to the repository
on:
  push:
    branches:
    - master
    - clippy
  pull_request:

jobs:
  ensure-conventions:
    name: Ensure conventions are followed
    runs-on: ubuntu-latest

    steps:
      - name: True
        run: /bin/true
  configlet:
    name: Setup configlet
    runs-on: ubuntu-latest

    steps:
      - name: True
        run: /bin/true
  compilation:
    name: Check compilation
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Setup toolchain
        uses: actions-rs/toolchain@v1
        with:
          toolchain: stable
          default: true

      - name: Install Clippy
        run: rustup component add clippy

      - name: Clippy on Tests
        env:
          CLIPPY: tests
        run: ./_test/check-exercises.sh

      - name: Clippy on Libs
        env:
          CLIPPY: lib
        run: ./_test/check-exercises.sh
  nightly-compilation:
    name: Check exercises on nightly (benchmark enabled)
    runs-on: ubuntu-latest
    continue-on-error: true # It's okay if the nightly job fails

    steps:
      - name: True
        run: /bin/true
